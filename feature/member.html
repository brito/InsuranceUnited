<form id=member>
  <i>To see and save your policy, please tell us how to contact you:</i>
  <input name=tel type=tel placeholder="by phone"> or
  <input name=email type=email placeholder="by email"><br>
  
  <span class=when-returning>
	  <i>If you have been here before</i>
	  <input name=password type=password data-typetoggle=#showpw placeholder="enter your password"><br>
	  <label><input id=showpw type=checkbox> Show Password</label><br>
  </span>
  
  <button>Continue</button>
</form>

<script>
// TODO implement as agnostic feature
recognize(
    $('#policy').addClass('when-authenticated').selector,
    'loaded');
    
$('#member')
  // comandeer submit
  .submit(function(e){
    // if ok, load next
    var next = $(this).slideUp()
      .nextAll('form:first').slideDown();
    recognize(location.hash = next[0].id, 'coming up');
    return false;
  })
  // peripherals
  .on('keyup', '[name=email]', function(){
    $(this).notify();
    var input = this;
    // debounce
    clearTimeout($(input).data('debounce'));
    $(input).data('debounce', setTimeout(function(){
      var rules = { is_email: /^[^@]+@.+\.[^.]{2,}$/ };
      for (var rule in rules) (function(matches){
        $(input).trigger('set', [rule, matches]);
      })(input.value.match(rules[rule]));
    }, 300));
  })
  // actions
  .on({ 
    'set': function(e, rule, matches){
      if (!matches) return;
      
	    if ('is_email' == rule)
	      $(e.target)
	        .closest('[data]')
	          .data('email', matches[0])
	          .trigger('change');
	  },
	  'call': function(e){
	    console.debug(e.type, arguments);
	  },
	  'authenticate': function(){
			// Stop password maskingâ Jacob Nielsen
			// http://www.useit.com/alertbox/passwords.html
			$('[name=password]').showPassword();
	  },
	  'change': function(){},
	  'init': function(e){
	    debug && console.info(e.type, this);
	  } })
  .trigger('init');

</script>